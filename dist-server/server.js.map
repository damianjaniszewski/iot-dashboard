{"version":3,"sources":["../server/server.js"],"names":["PORT","process","env","notifier","event","test","request","path","params","id","use","param","then","result","sensor","Promise","reject","statusCode","message","resolve","app","json","static","join","__dirname","get","req","res","sendFile","server","createServer","listen","console","log"],"mappings":";;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;;;AAEA,IAAMA,OAAOC,QAAQC,GAAR,CAAYF,IAAZ,IAAoB,IAAjC;;AAEA,IAAMG,WAAW,wBAAjB;;AAEA,uBACE,OADF,EAEE,UAACC,KAAD,EAAW;AACT;AACAD,WAASE,IAAT,CAAc,UAACC,OAAD,EAAa;AACzB;AACA,QAAIA,QAAQC,IAAR,KAAiB,iBAAjB,IAAsCD,QAAQE,MAAR,CAAeC,EAAf,KAAsBL,MAAMK,EAAtE,EAA0E;AACxE,aAAO,KAAP;AACD;AACD,WAAO,IAAP;AACD,GAND;AAOD,CAXH;;AAcAN,SAASO,GAAT,CAAa,aAAb,EAA4B;AAAA,SAAM,sBAAN;AAAA,CAA5B;AACAP,SAASO,GAAT,CAAa,cAAb,EAA6B;AAAA,SAAM,uBAAN;AAAA,CAA7B;AACAP,SAASO,GAAT,CAAa,iBAAb,EAAgC;AAAA,SAC9B,qBAAUC,MAAMF,EAAhB,EAAoBG,IAApB,CAAyB,UAACC,MAAD,EAAY;AACnC,QAAI,CAACA,OAAOC,MAAZ,EAAoB;AAClB,aAAOC,QAAQC,MAAR,CAAe,EAAEC,YAAY,GAAd,EAAmBC,SAAS,WAA5B,EAAf,CAAP;AACD;AACD,WAAOH,QAAQI,OAAR,CAAgBN,MAAhB,CAAP;AACD,GALD,CAD8B;AAAA,CAAhC;;AASA,IAAMO,MAAM,yBACTV,GADS,CACL,4BADK,EAETA,GAFS,CAEL,6BAFK,EAGTA,GAHS,CAGL,sBAAO,MAAP,CAHK,EAITA,GAJS,CAIL,qBAAWW,IAAX,EAJK,CAAZ;;AAMA;AACAD,IAAIV,GAAJ,CAAQ,MAAR;;AAEA;AACAU,IAAIV,GAAJ,CAAQ,GAAR,EAAa,kBAAQY,MAAR,CAAe,eAAKC,IAAL,CAAUC,SAAV,EAAqB,UAArB,CAAf,CAAb;AACAJ,IAAIK,GAAJ,CAAQ,IAAR,EAAc,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC1BA,MAAIC,QAAJ,CAAa,eAAKT,OAAL,CAAa,eAAKI,IAAL,CAAUC,SAAV,EAAqB,qBAArB,CAAb,CAAb;AACD,CAFD;;AAIA,IAAMK,SAAS,eAAKC,YAAL,CAAkBV,GAAlB,CAAf;AACAS,OAAOE,MAAP,CAAc/B,IAAd;AACAG,SAAS4B,MAAT,CAAgBF,MAAhB;;AAEAG,QAAQC,GAAR,6BAAsCjC,IAAtC","file":"server.js","sourcesContent":["import compression from 'compression';\nimport express from 'express';\nimport http from 'http';\nimport morgan from 'morgan';\nimport bodyParser from 'body-parser';\nimport cookieParser from 'cookie-parser';\nimport path from 'path';\nimport api from './api';\nimport { addNotifier, getEvents, getSensors, getSensor } from './data';\nimport Notifier from './notifier';\n\nconst PORT = process.env.PORT || 8102;\n\nconst notifier = new Notifier();\n\naddNotifier(\n  'event',\n  (event) => {\n    // this can be invoked multiple times as new requests happen\n    notifier.test((request) => {\n      // we should skip notify if the id of the event does not match the payload\n      if (request.path === '/api/sensor/:id' && request.params.id !== event.id) {\n        return false;\n      }\n      return true;\n    });\n  }\n);\n\nnotifier.use('/api/events', () => getEvents());\nnotifier.use('/api/sensors', () => getSensors());\nnotifier.use('/api/sensor/:id', param => (\n  getSensor(param.id).then((result) => {\n    if (!result.sensor) {\n      return Promise.reject({ statusCode: 404, message: 'Not Found' });\n    }\n    return Promise.resolve(result);\n  })\n));\n\nconst app = express()\n  .use(compression())\n  .use(cookieParser())\n  .use(morgan('tiny'))\n  .use(bodyParser.json());\n\n// REST API\napp.use('/api', api);\n\n// UI\napp.use('/', express.static(path.join(__dirname, '/../dist')));\napp.get('/*', (req, res) => {\n  res.sendFile(path.resolve(path.join(__dirname, '/../dist/index.html')));\n});\n\nconst server = http.createServer(app);\nserver.listen(PORT);\nnotifier.listen(server);\n\nconsole.log(`Server started at port ${PORT}`);\n"]}